<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Resume Screener with Zoho & Make.com Integration</title>
</head>
<body>

  <!-- Simulated portal header (your real page will already have this) -->
  <header style="display:none;">
    <span class="theme-portal-username" data-portal-user-name>
      Hi, optiontrader91
    </span>
  </header>

  <!-- 1) This is where Zoho will inject the form -->
  <div id="zohoFormContainer"></div>

  <!-- 2) Load Zoho’s official embed library -->
  <script src="https://forms.zohopublic.com/xoo/form/ResumeScreenerDynamicFiles/js/responsive.js"></script>

  <!-- 3) Initialization: extract username, build submissionId, embed & hook onSuccess -->
  <script>
  document.addEventListener('DOMContentLoaded', function(){

    // A) Extract the logged-in portal username once
    let username = '';
    (function(){
      const span = document.querySelector(
        'span.theme-portal-username[data-portal-user-name]'
      );
      if (span) {
        username = span.textContent.replace(/^Hi,\s*/i,'').trim();
      }
      console.log("Extracted portal username:", username);
    })();

    // B) Build a unique Submission ID
    const submissionId = username + "_" + Date.now();
    console.log("Built submissionId:", submissionId);

    // C) When Zoho’s embed script is ready...
    ZOHO.embeddedApp.on("load", function(){
      ZOHO.embeddedApp.init({
        // 1) Which DIV to render into
        formContainer: "zohoFormContainer",
        // 2) Your Zoho form’s permanent ID
        formId:        "pjPYaosmnAbiv52anOuMikTY1WLRcIJuHqmUfs3VlGU",

        // 3) Each time the form loads, prefill these two hidden fields
        onFormLoad: function(zohoForm) {
          ZOHO.embeddedApp.addFieldToForm(zohoForm, "Username",      username);
          ZOHO.embeddedApp.addFieldToForm(zohoForm, "Submission ID", submissionId);
        },

        // 4) As soon as Zoho confirms the user’s submit…
        onSuccess: function(zohoData){
          console.log("Zoho form submitted:", zohoData);

          // 5) Fire your Make.com webhook immediately
          fetch("https://hook.us1.make.com/n2qll3gblut2oqd6x7x149i650l3s1dx", {
            method:  "POST",
            headers: { "Content-Type":"application/json" },
            body:    JSON.stringify({
              "Username":       username,
              "Submission ID":  submissionId,
              // you can also pass along Zoho’s own response data:
              "zohoRawData":    zohoData
            })
          })
          .then(r => {
            if (r.ok)  console.log("✅ Make.com webhook OK");
            else       console.warn("⚠️ Make.com returned", r.status);
          })
          .catch(err => console.error("❌ Webhook error:", err));
        }
      });
    });

  });
  </script>

</body>
</html>
